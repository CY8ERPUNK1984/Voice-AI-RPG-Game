# План реализации

- [x] 1. Настройка структуры проекта и базовых интерфейсов
  - Создать структуру директорий для frontend (React) и backend (Node.js)
  - Настроить TypeScript конфигурацию для обеих частей
  - Установить основные зависимости (React, Express, Socket.io, Zustand)
  - Создать базовые TypeScript интерфейсы для моделей данных
  - _Требования: 1.1, 2.1, 3.1, 4.1, 5.1_

- [x] 2. Реализация базового чат-интерфейса
  - Создать React компонент ChatInterface с отображением сообщений
  - Реализовать компонент Message для отдельных сообщений пользователя и ИИ
  - Добавить прокрутку чата и автоматическое скроллирование к новым сообщениям
  - Создать базовую стилизацию с Tailwind CSS
  - Написать unit тесты для чат компонентов
  - _Требования: 1.1, 1.2, 1.3_

- [x] 3. Создание системы управления историями
- [x] 3.1 Реализация модели Story и базы данных историй
  - Создать TypeScript интерфейс Story с полями id, title, description, genre, initialPrompt
  - Создать JSON файлы с примерами игровых историй (фэнтези, sci-fi, детектив)
  - Реализовать сервис StoryService для загрузки и управления историями
  - Написать unit тесты для StoryService
  - _Требования: 5.1, 5.2_

- [x] 3.2 Создание компонента выбора историй
  - Реализовать React компонент StorySelector для отображения списка историй
  - Добавить фильтрацию историй по жанрам
  - Создать карточки историй с превью описания
  - Реализовать обработку выбора истории пользователем
  - Написать unit тесты для StorySelector
  - _Требования: 5.1, 5.2, 5.3_

- [x] 4. Настройка WebSocket соединения и session management
  - Создать WebSocket сервер с Socket.io на backend
  - Реализовать GameSessionManager для управления игровыми сессиями
  - Создать WebSocket клиент на frontend с автоматическим переподключением
  - Реализовать обработку событий join-game, send-message, game-response
  - Написать integration тесты для WebSocket соединения
  - _Требования: 3.1, 5.3, 5.4_

- [x] 5. Реализация LLM интеграции
- [x] 5.1 Создание LLM сервиса
  - Реализовать интерфейс LLMService и класс OpenAILLM
  - Настроить интеграцию с OpenAI GPT API
  - Создать систему промптов для RPG контекста с учетом выбранной истории
  - Реализовать обработку ошибок и retry логику
  - Написать unit тесты с mock OpenAI API
  - _Требования: 3.1, 3.2, 3.4, 5.4_

- [x] 5.2 Интеграция LLM с игровыми сессиями
  - Подключить LLM сервис к GameSessionManager
  - Реализовать передачу контекста истории и предыдущих сообщений в LLM
  - Добавить обработку LLM ответов в WebSocket события
  - Создать систему поддержания контекста игры между сообщениями
  - Написать integration тесты для полного flow сообщений
  - _Требования: 3.1, 3.2, 3.3, 3.4_

- [-] 6. Реализация голосового ввода (ASR)
- [x] 6.1 Создание ASR сервиса с Web Speech API
  - Реализовать интерфейс ASRService и класс WebSpeechASR
  - Создать React компонент VoiceInput с кнопкой записи
  - Добавить визуальную индикацию состояния записи
  - Реализовать обработку результатов распознавания речи
  - Написать unit тесты для ASR компонентов
  - _Требования: 2.1, 2.2, 2.3_

- [ ] 6.2 Добавление fallback ASR с Whisper API
  - Реализовать класс WhisperASR для интеграции с OpenAI Whisper
  - Создать логику автоматического переключения между Web Speech API и Whisper
  - Добавить обработку аудио файлов и отправку на backend
  - Реализовать обработку ошибок ASR с пользовательскими уведомлениями
  - Написать integration тесты для обоих ASR сервисов
  - _Требования: 2.1, 2.2, 2.3, 2.4_

- [ ] 7. Реализация синтеза речи (TTS)
- [ ] 7.1 Создание TTS сервиса с Web Speech API
  - Реализовать интерфейс TTSService и класс WebSpeechTTS
  - Создать React компонент AudioPlayer для воспроизведения синтезированной речи
  - Добавить контроли воспроизведения (play, pause, stop)
  - Реализовать автоматическое воспроизведение ответов ИИ
  - Написать unit тесты для TTS компонентов
  - _Требования: 4.1, 4.2, 4.3_

- [ ] 7.2 Интеграция TTS с игровым flow
  - Подключить TTS к обработке ответов LLM в GameSessionManager
  - Реализовать очередь TTS для последовательного воспроизведения
  - Добавить обработку ошибок TTS с fallback на текстовый режим
  - Создать настройки TTS (скорость, голос, громкость)
  - Написать integration тесты для полного voice pipeline
  - _Требования: 4.1, 4.2, 4.3, 4.4_

- [ ] 8. Создание панели настроек аудио
  - Реализовать React компонент SettingsPanel с аудио настройками
  - Добавить контроли для громкости TTS, чувствительности ASR, скорости речи
  - Создать переключатель включения/отключения TTS
  - Реализовать сохранение настроек в localStorage
  - Написать unit тесты для компонента настроек
  - _Требования: 6.1, 6.2, 6.3, 6.4_

- [ ] 9. Реализация обработки ошибок и пользовательских уведомлений
  - Создать систему централизованной обработки ошибок на frontend
  - Реализовать компонент ErrorBoundary для React приложения
  - Добавить toast уведомления для ошибок ASR, LLM, TTS
  - Создать fallback UI для случаев недоступности сервисов
  - Написать unit тесты для error handling компонентов
  - _Требования: 2.4, 3.3, 4.4_

- [ ] 10. Оптимизация производительности и UX
- [ ] 10.1 Реализация loading состояний и индикаторов
  - Добавить loading спиннеры для ASR, LLM и TTS операций
  - Создать индикатор "ИИ печатает" во время генерации ответа
  - Реализовать прогресс бар для длительных TTS операций
  - Добавить skeleton loading для списка историй
  - Написать unit тесты для loading компонентов
  - _Требования: 2.1, 3.1, 4.1_

- [ ] 10.2 Оптимизация аудио обработки
  - Реализовать debouncing для голосового ввода
  - Добавить compression для аудио файлов перед отправкой
  - Создать audio streaming для больших TTS файлов
  - Оптимизировать memory usage при работе с аудио
  - Написать performance тесты для аудио pipeline
  - _Требования: 2.1, 4.1_

- [ ] 11. Создание end-to-end тестов
  - Настроить Playwright для E2E тестирования
  - Создать тесты для полного игрового flow: выбор истории → голосовой ввод → ответ ИИ → TTS
  - Добавить тесты для error scenarios и fallback механизмов
  - Реализовать тесты для различных браузеров и устройств
  - Создать CI/CD pipeline для автоматического запуска тестов
  - _Требования: 1.1, 2.1, 3.1, 4.1, 5.1_

- [ ] 12. Финальная интеграция и полировка
  - Интегрировать все компоненты в единое приложение
  - Провести полное тестирование voice pipeline
  - Оптимизировать производительность и исправить найденные баги
  - Добавить финальную стилизацию и улучшения UX
  - Создать документацию по развертыванию и использованию
  - _Требования: 1.1, 2.1, 3.1, 4.1, 5.1, 6.1_